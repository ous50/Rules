- RULE-SET,Reject,AdBlock
- RULE-SET,Special,DIRECT



- RULE-SET,BilibiliHMT,HMT
- RULE-SET,Bilibili,AsianTV
- RULE-SET,iQiyi,AsianTV
- RULE-SET,Letv,AsianTV
# - RULE-SET,MOO,AsianTV
- RULE-SET,Netease Music,AsianTV
- RULE-SET,Tencent Video,AsianTV
- RULE-SET,Youku,AsianTV
- RULE-SET,WeTV,AsianTV

- RULE-SET,Netflix,GlobalTV
- RULE-SET,Spotify,GlobalTV
# - RULE-SET,YouTube Music,YouTube
- RULE-SET,YouTube,GlobalTV
- RULE-SET,Disney Plus,GlobalTV
- RULE-SET,ABC,GlobalTV
- RULE-SET,Abema TV,GlobalTV
- RULE-SET,Amazon,GlobalTV
- RULE-SET,Apple News,GlobalTV
- RULE-SET,Apple TV,GlobalTV
- RULE-SET,Bahamut,GlobalTV
- RULE-SET,BBC iPlayer,GlobalTV
- RULE-SET,DAZN,GlobalTV
- RULE-SET,Discovery Plus,GlobalTV
- RULE-SET,encoreTVB,GlobalTV
- RULE-SET,Fox Now,GlobalTV
- RULE-SET,Fox+,GlobalTV
- RULE-SET,HBO,GlobalTV
- RULE-SET,Hulu Japan,GlobalTV
- RULE-SET,Hulu,GlobalTV
- RULE-SET,Japonx,GlobalTV
- RULE-SET,JOOX,GlobalTV
- RULE-SET,KKBOX,GlobalTV
- RULE-SET,KKTV,GlobalTV
- RULE-SET,Line TV,GlobalTV
- RULE-SET,myTV SUPER,GlobalTV
- RULE-SET,Pandora,GlobalTV
- RULE-SET,PBS,GlobalTV
- RULE-SET,Pornhub,GlobalTV
- RULE-SET,Soundcloud,GlobalTV
- RULE-SET,ViuTV,GlobalTV


- RULE-SET,Steam,SteamAndPayPal
- RULE-SET,Speedtest,Speedtest
- RULE-SET,PayPal,SteamAndPayPal


- RULE-SET,PROXY,Proxy
- RULE-SET,Telegram,Proxy

- RULE-SET,Apple,AppleAndMicrosoft
- RULE-SET,Microsoft,AppleAndMicrosoft

- RULE-SET,Scholar,Scholar

- RULE-SET,Domestic,Domestic
- RULE-SET,Domestic IPs,Domestic

- RULE-SET,LAN,DIRECT
- GEOIP,CN,Domestic
- MATCH,Others

script:
  code: |
    def main(ctx, metadata):
        port_list = [21, 22, 23, 53, 80, 123, 143, 194, 443, 465, 587, 853, 993, 995, 998, 2052, 2053, 2082, 2083, 2086, 2095, 2096, 5222, 5228, 5229, 5230, 8080, 8443, 8880, 8888, 8889]
        ruleset_action = {"Reject": "AdBlock",
            "Special": "DIRECT",
            "Netflix": "GlobalTV",
            "Spotify": "GlobalTV",
            "YouTube": "GlobalTV",
            "Disney Plus": "GlobalTV",
            "BilibiliHMT": "HMT",
            "Bilibili": "AsianTV",
            "iQiyi": "AsianTV",
            "Letv": "AsianTV",
            "Netease Music": "AsianTV",
            "Tencent Video": "AsianTV",
            "Youku": "AsianTV",
            "WeTV": "AsianTV",
            "ABC": "GlobalTV",
            "Abema TV": "GlobalTV",
            "Amazon": "GlobalTV",
            "Apple News": "GlobalTV",
            "Apple TV": "GlobalTV",
            "Bahamut": "GlobalTV",
            "BBC iPlayer": "GlobalTV",
            "DAZN": "GlobalTV",
            "Discovery Plus": "GlobalTV",
            "encoreTVB": "GlobalTV",
            "Fox Now": "GlobalTV",
            "Fox+": "GlobalTV",
            "HBO": "GlobalTV",
            "Hulu Japan": "GlobalTV",
            "Hulu": "GlobalTV",
            "Japonx": "GlobalTV",
            "JOOX": "GlobalTV",
            "KKBOX": "GlobalTV",
            "KKTV": "GlobalTV",
            "Line TV": "GlobalTV",
            "myTV SUPER": "GlobalTV",
            "Pandora": "GlobalTV",
            "PBS": "GlobalTV",
            "Pornhub": "GlobalTV",
            "Soundcloud": "GlobalTV",
            "ViuTV": "GlobalTV",
            "Telegram": "Proxy",
            "Steam": "SteamAndPayPal",
            "Speedtest": "Speedtest",
            "PayPal": "SteamAndPayPal",
            "Microsoft": "AppleAndMicrosoft",
            "PROXY": "Proxy",
            "Apple": "AppleAndMicrosoft",
            "Scholar": "Scholar",
            "Domestic": "Domestic",
            "Domestic IPs": "Domestic",
            "LAN": "DIRECT"
            }
        port = int(metadata["dst_port"])
        if port not in port_list:
            return "DIRECT"
        for rule_name in ctx.rule_providers.keys():
            if ctx.rule_providers[rule_name].match(metadata):
                return ruleset_action[rule_name]
        ip = metadata["dst_ip"] or ctx.resolve_ip(metadata["host"])
        if ip == "":
          return "DIRECT"
        code = ctx.geoip(ip)
        if code == "CN":
          return "Domestic"
        return "Others"
rule-providers:
  Reject:
    type: http
    behavior: classical
    path: ./Rules/Reject
    interval: 86400
  Special:
    type: http
    behavior: classical
    path: ./Rules/Special
    interval: 86400
  Bilibili:
    type: http
    behavior: classical
    path: ./Rules/Media/AsianTVHMT/BilibiliHMT
    interval: 86400
  Bilibili:
    type: http
    behavior: classical
    path: ./Rules/Media/AsianTV/Bilibili
    interval: 86400
  iQiyi:
    type: http
    behavior: classical
    path: ./Rules/Media/AsianTV/iQiyi
    interval: 86400
  Letv:
    type: http
    behavior: classical
    path: ./Rules/Media/AsianTV/Letv
    interval: 86400
  # MOO:
  #   type: http
  #   behavior: classical
  #   url: 'https://cdn.jsdelivr.net/gh/lhie1/Rules@master/Clash/Provider/Media/MOO.yaml'
  #   path: ./Rules/Media/MOO
  #   interval: 86400
  Netease Music:
    type: http
    behavior: classical
    path: ./Rules/Media/AsianTV/Netease_Music
    interval: 86400
  Tencent Video:
    type: http
    behavior: classical
    path: ./Rules/Media/AsianTV/Tencent_Video
    interval: 86400
  Youku:
    type: http
    behavior: classical
    path: ./Rules/Media/AsianTV/Youku
    interval: 86400
  WeTV:
    type: http
    behavior: classical
    path: ./Rules/Media/AsianTV/WeTV
    interval: 86400
  Netflix:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Netflix
    interval: 86400
  Spotify:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Spotify
    interval: 86400
  # YouTube Music:
  #   type: http
  #   behavior: classical
  #   url: 'https://cdn.jsdelivr.net/gh/lhie1/Rules@master/Clash/Provider/Media/YouTube%20Music.yaml'
  #   path: ./Rules/Media/YouTube_Music
  #   interval: 86400
  YouTube:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/YouTube
    interval: 86400
  ABC:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/ABC
    interval: 86400
  Abema TV:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Abema_TV
    interval: 86400
  Amazon:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Amazon
    interval: 86400
  Apple News:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Apple_News
    interval: 86400
  Apple TV:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Apple_TV
    interval: 86400
  Bahamut:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Bahamut
    interval: 86400
  BBC iPlayer:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/BBC_iPlayer
    interval: 86400
  DAZN:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/DAZN
    interval: 86400
  Discovery Plus:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Discovery_Plus
    interval: 86400
  Disney Plus:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Disney_Plus
    interval: 86400
  encoreTVB:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/encoreTVB
    interval: 86400
  Fox Now:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Fox_Now
    interval: 86400
  Fox+:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Fox+
    interval: 86400
  HBO:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/HBO
    interval: 86400
  Hulu Japan:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Hulu_Japan
    interval: 86400
  Hulu:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Hulu
    interval: 86400
  Japonx:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Japonx
    interval: 86400
  JOOX:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/JOOX
    interval: 86400
  KKBOX:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/KKBOX
    interval: 86400
  KKTV:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/KKTV
    interval: 86400
  Line TV:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Line_TV
    interval: 86400
  myTV SUPER:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/myTV_SUPER
    interval: 86400
  Pandora:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Pandora
    interval: 86400
  PBS:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/PBS
    interval: 86400
  Pornhub:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Pornhub
    interval: 86400
  Soundcloud:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/Soundcloud
    interval: 86400
  ViuTV:
    type: http
    behavior: classical
    path: ./Rules/Media/GlobalTV/ViuTV
    interval: 86400
  Telegram:
    type: http
    behavior: classical
    path: ./Rules/Telegram
    interval: 86400
  Steam:
    type: http
    behavior: classical
    path: ./Rules/Steam
    interval: 86400
  Speedtest:
    type: http
    behavior: classical
    path: ./Rules/Speedtest
    interval: 86400
  PayPal:
    type: http
    behavior: classical
    path: ./Rules/PayPal
    interval: 86400
  Microsoft:
    type: http
    behavior: classical
    path: ./Rules/Microsoft
    interval: 86400
  PROXY:
    type: http
    behavior: classical
    path: ./Rules/Proxy
    interval: 86400
  Domestic:
    type: http
    behavior: classical
    path: ./Rules/Domestic
    interval: 86400
  Apple:
    type: http
    behavior: classical
    path: ./Rules/Apple
    interval: 86400
  Scholar:
    type: http
    behavior: classical
    path: ./Rules/Scholar
    interval: 86400
  Domestic IPs:
    type: http
    behavior: ipcidr
    path: ./Rules/Domestic_IPs
    interval: 86400
  LAN:
    type: http
    behavior: classical
    path: ./Rules/LAN
    interval: 86400